{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://spiralsafe.dev/vortex-curl-vector-surjection-v1.json",
  "title": "Vortex Curl Vector Surjection State",
  "description": "Schema for the Vortex Curl Vector Surjection protocol state, describing self-maintaining coherence loops through fibonacci resonance.",
  "type": "object",
  "required": ["meta", "active_vortexes", "current_global_collapse_proximity"],
  "properties": {
    "$schema": {
      "type": "string",
      "const": "https://spiralsafe.dev/vortex-curl-vector-surjection-v1.json"
    },
    "meta": {
      "type": "object",
      "description": "Metadata about the current vortex iteration",
      "required": ["iteration", "date", "coherence_projection", "emergent_quality"],
      "properties": {
        "iteration": {
          "type": "integer",
          "minimum": 0,
          "description": "Current iteration number of the vortex engine"
        },
        "date": {
          "type": "string",
          "description": "ISO 8601 timestamp of the iteration"
        },
        "coherence_projection": {
          "type": "string",
          "pattern": "^[0-9]+–[0-9]+%$",
          "description": "Projected coherence range as percentage (e.g., '93–96%')"
        },
        "emergent_quality": {
          "type": "string",
          "pattern": "^[0-9]+(\\.[0-9]+)?%$",
          "description": "Emergent quality percentage (e.g., '92.7%')"
        },
        "self_birth_condition": {
          "type": "string",
          "description": "Description of the self-birth condition for vortex suggestions"
        },
        "surjection_rule": {
          "type": "string",
          "description": "The surjection mapping rule from history to collapse point"
        },
        "collapse_trigger": {
          "type": "string",
          "description": "Condition for triggering self-maintaining loop status"
        }
      }
    },
    "active_vortexes": {
      "type": "array",
      "description": "List of active vortex vectors",
      "items": {
        "$ref": "#/definitions/VortexVector"
      }
    },
    "current_global_collapse_proximity": {
      "type": "string",
      "pattern": "^[0-9]+(\\.[0-9]+)?%$",
      "description": "Weighted average of all vortex resonance scores"
    },
    "strongest_resonance_vector": {
      "type": ["string", "null"],
      "description": "Identifier of the vortex with highest resonance score"
    },
    "reason": {
      "type": "string",
      "description": "Rationale for the strongest resonance selection"
    },
    "immediate_suggestion": {
      "type": "string",
      "description": "Recommended action based on current vortex state"
    },
    "next_action_trigger": {
      "type": "string",
      "description": "Description of how to proceed with the suggestion"
    }
  },
  "definitions": {
    "VortexVector": {
      "type": "object",
      "description": "A directed evolution path through coherence space",
      "required": ["vector", "surjection_description", "collapse_point", "fibonacci_weight", "resonance_score"],
      "properties": {
        "vector": {
          "type": "string",
          "description": "Human-readable description of the vortex evolution path"
        },
        "surjection_description": {
          "type": "string",
          "description": "How the history manifold maps to the collapse point"
        },
        "collapse_point": {
          "oneOf": [
            { "type": "string" },
            { "$ref": "#/definitions/CollapsePoint" }
          ],
          "description": "Terminal collapse state of the vortex"
        },
        "self_maintained_system_birthed": {
          "type": "string",
          "description": "Description of the autonomous system created by collapse"
        },
        "vortex_type": {
          "type": "string",
          "enum": ["qrc_hybrid", "qdi_prompt", "reservoir_audit", "remix"],
          "description": "Type classification of the vortex"
        },
        "fibonacci_weight": {
          "oneOf": [
            {
              "type": "integer",
              "minimum": 1,
              "description": "Fibonacci sequence weight (1, 2, 3, 5, 8, 13, ...)"
            },
            {
              "type": "string",
              "description": "Variable weight (for user-defined vortexes)"
            }
          ]
        },
        "resonance_score": {
          "oneOf": [
            {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Coherence measure [0.0, 1.0]"
            },
            {
              "type": "string",
              "description": "Pending resonance (for user-defined vortexes)"
            }
          ]
        },
        "visual_anchor": {
          "type": "string",
          "description": "Visual representation hint for the vortex"
        },
        "is_self_maintaining": {
          "type": "boolean",
          "description": "Whether resonance exceeds the 60% emergence threshold"
        },
        "history_length": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of accumulated history states"
        },
        "created_at": {
          "type": "string",
          "description": "ISO 8601 timestamp of vortex creation"
        }
      }
    },
    "CollapsePoint": {
      "type": "object",
      "description": "Terminal state of a vortex surjection",
      "required": ["description", "birthed_system"],
      "properties": {
        "description": {
          "type": "string",
          "description": "Description of the collapse state"
        },
        "birthed_system": {
          "type": "string",
          "description": "The autonomous system created by the collapse"
        },
        "coherence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Coherence level at collapse"
        },
        "timestamp": {
          "type": "string",
          "description": "ISO 8601 timestamp of collapse"
        },
        "metadata": {
          "type": "object",
          "description": "Additional collapse metadata"
        }
      }
    }
  }
}
